<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Coding Challenge Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-area {
            padding: 40px;
        }

        .difficulty-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .difficulty-btn.active {
            background: #2196F3;
        }

        .challenge-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #2196F3;
        }

        .challenge-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 15px;
        }

        .challenge-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }

        .answer-section {
            margin-top: 25px;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .answer-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-btn:hover {
            border-color: #2196F3;
            transform: translateY(-2px);
        }

        .answer-btn.selected {
            border-color: #2196F3;
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .answer-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .answer-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #28a745;
            animation: correctPulse 0.6s ease-out;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        @keyframes correctPulse {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confettiFall 3s linear forwards;
        }

        .confetti:nth-child(2n) { background: #4ecdc4; }
        .confetti:nth-child(3n) { background: #45b7d1; }
        .confetti:nth-child(4n) { background: #96ceb4; }
        .confetti:nth-child(5n) { background: #feca57; }
        .confetti:nth-child(6n) { background: #ff9ff3; }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            padding: 20px 30px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
            pointer-events: none;
            animation: scorePopup 2s ease-out forwards;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }

        @keyframes scorePopup {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            border-color: #4CAF50;
            animation: correctAnswer 0.8s ease-out;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            30% { transform: scale(1.05); box-shadow: 0 12px 35px rgba(76, 175, 80, 0.6); }
            100% { transform: scale(1); }
        }

        .streak-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(200px);
            transition: all 0.5s ease;
        }

        .streak-indicator.show {
            transform: translateX(0);
            animation: streakBounce 0.6s ease-out;
        }

        @keyframes streakBounce {
            0% { transform: translateX(0) scale(1); }
            50% { transform: translateX(-10px) scale(1.1); }
            100% { transform: translateX(0) scale(1); }
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .next-btn {
            background: #FF9800;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            margin-left: 15px;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            background: #F57C00;
            transform: translateY(-1px);
        }

        .nav-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .results-modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.7) translateY(50px);
            transition: all 0.3s ease;
        }

        .modal-overlay.show .results-modal {
            transform: scale(1) translateY(0);
        }

        .results-header {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #2196F3;
        }

        .result-stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2196F3;
        }

        .result-stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .performance-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 20px 0;
            font-size: 1.1rem;
        }

        .performance-excellent {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
        }

        .performance-good {
            background: linear-gradient(135deg, #FF9800, #FFC107);
            color: white;
        }

        .performance-needs-improvement {
            background: linear-gradient(135deg, #f44336, #FF5722);
            color: white;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-area {
                padding: 20px;
            }
            
            .answer-options {
                grid-template-columns: 1fr;
            }

            .results-modal {
                padding: 30px 20px;
                margin: 20px;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>☕ Java Coding Challenge Game</h1>
            <p>Test your Java skills with interactive coding challenges!</p>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="score">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="streak">0</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="completed">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
        </div>

        <div class="game-area">
            <div class="difficulty-selector">
                <button class="difficulty-btn active" data-level="beginner">🌱 Beginner</button>
                <button class="difficulty-btn" data-level="intermediate">🚀 Intermediate</button>
                <button class="difficulty-btn" data-level="advanced">⚡ Advanced</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
                <div class="current-score" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border-radius: 25px; font-size: 1rem; display: inline-flex; align-items: center; gap: 8px;">
                    🏆 Score: <span id="currentScore">0</span>
                </div>
            </div>

            <div class="challenge-card" id="challengeCard">
                <!-- Challenge content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal-overlay" id="resultsModal">
        <div class="results-modal">
            <div class="results-header" id="resultsEmoji">🎉</div>
            <div class="results-title" id="resultsTitle">Level Complete!</div>
            <div class="performance-badge" id="performanceBadge">Excellent Work!</div>
            
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-number" id="finalScore">0</div>
                    <div class="result-stat-label">Final Score</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-number" id="correctAnswers">0</div>
                    <div class="result-stat-label">Correct Answers</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-number" id="accuracy">0%</div>
                    <div class="result-stat-label">Accuracy</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-number" id="maxStreak">0</div>
                    <div class="result-stat-label">Best Streak</div>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="game.tryNextLevel()">Try Next Level</button>
                <button class="modal-btn secondary" onclick="game.retryLevel()">Retry Level</button>
                <button class="modal-btn secondary" onclick="game.closeModal()">Continue</button>
            </div>
        </div>
    </div>

    <script>
        class JavaChallengeGame {
            constructor() {
                this.score = 0;
                this.streak = 0;
                this.completed = 0;
                this.currentLevel = 'beginner';
                this.currentChallengeIndex = 0;
                this.selectedAnswer = null;
                this.hasSubmittedAnswer = false;
                this.isLoading = false;
                this.apiChallenges = {};
                
                // Level tracking
                this.levelStats = {
                    correctAnswers: 0,
                    totalQuestions: 0,
                    maxStreak: 0,
                    levelScore: 0
                };
                
                // JSON Configuration - Add your JSON file URLs here
                this.jsonSources = [
                    // Primary source: Your GitHub JSON file
                    'https://raw.githubusercontent.com/ravirameshbisht/render/refs/heads/main/file.json',
                    
                    // Backup sources (optional)
                    'https://cdn.jsdelivr.net/gh/ravirameshbisht/render@main/file.json'
                ];
                
                // Fallback challenges (used when API fails)
                this.fallbackChallenges = {
                    beginner: [
                        {
                            title: "Variable Declaration",
                            description: "What is the correct way to declare an integer variable in Java?",
                            code: `// Which declaration is correct?
// Option A: int number = 42;
// Option B: Integer number = 42;
// Option C: int number = "42";
// Option D: number int = 42;`,
                            options: [
                                "int number = 42;",
                                "Integer number = 42;",
                                'int number = "42";',
                                "number int = 42;"
                            ],
                            correct: 0,
                            explanation: "Option A is correct. 'int' is the primitive data type for integers, and we assign the value 42 directly."
                        },
                        {
                            title: "String Concatenation",
                            description: "What will be the output of this Java code?",
                            code: `String firstName = "Java";
String lastName = "Developer";
System.out.println(firstName + " " + lastName);`,
                            options: [
                                "Java Developer",
                                "JavaDeveloper",
                                "Java + Developer",
                                "Compilation Error"
                            ],
                            correct: 0,
                            explanation: "The + operator concatenates strings. The space between quotes adds a space between the names."
                        },
                        {
                            title: "Array Declaration",
                            description: "Which is the correct way to declare an array of integers in Java?",
                            code: `// Choose the correct array declaration:`,
                            options: [
                                "int[] numbers = new int[5];",
                                "int numbers[] = new int[5];",
                                "Both A and B are correct",
                                "array int numbers = new int[5];"
                            ],
                            correct: 2,
                            explanation: "Both int[] numbers and int numbers[] are valid array declaration syntaxes in Java."
                        }
                    ],
                    intermediate: [
                        {
                            title: "Method Overloading",
                            description: "Which methods can coexist in the same class (method overloading)?",
                            code: `public class Calculator {
    // Which combination is valid?
    public int add(int a, int b) { return a + b; }
    
    // Can we also have these?
}`,
                            options: [
                                "public double add(double a, double b)",
                                "public int add(int x, int y)",
                                "public void add(int a, int b)",
                                "Both A and C"
                            ],
                            correct: 3,
                            explanation: "Method overloading allows different parameter types (A) or different return types with same parameters (C). Option B has same signature."
                        },
                        {
                            title: "Exception Handling",
                            description: "What happens when this code runs?",
                            code: `try {
    int result = 10 / 0;
    System.out.println("Result: " + result);
} catch (ArithmeticException e) {
    System.out.println("Cannot divide by zero!");
} finally {
    System.out.println("Finally block executed");
}`,
                            options: [
                                "Result: Infinity\nFinally block executed",
                                "Cannot divide by zero!\nFinally block executed",
                                "Compilation error",
                                "Runtime error with no output"
                            ],
                            correct: 1,
                            explanation: "Division by zero throws ArithmeticException, which is caught. The finally block always executes."
                        },
                        {
                            title: "Collections Framework",
                            description: "Which collection should you use for unique elements with fast lookup?",
                            code: `// You need to store unique user IDs with O(1) lookup time
// Which collection is best?

Collection<String> userIds = new ____<>();`,
                            options: [
                                "ArrayList",
                                "LinkedList",
                                "HashSet",
                                "TreeSet"
                            ],
                            correct: 2,
                            explanation: "HashSet provides O(1) average lookup time and automatically ensures uniqueness of elements."
                        }
                    ],
                    advanced: [
                        {
                            title: "Generics and Wildcards",
                            description: "Which method signature correctly uses wildcards?",
                            code: `// You want a method that can accept List of any Number subtype
// and return the sum as double

public static double sum(_______ numbers) {
    double total = 0;
    for (Number n : numbers) {
        total += n.doubleValue();
    }
    return total;
}`,
                            options: [
                                "List<Number> numbers",
                                "List<? extends Number> numbers",
                                "List<? super Number> numbers",
                                "List<?> numbers"
                            ],
                            correct: 1,
                            explanation: "List<? extends Number> allows the method to accept List<Integer>, List<Double>, etc. - any subtype of Number."
                        },
                        {
                            title: "Stream API",
                            description: "What does this Stream operation return?",
                            code: `List<String> words = Arrays.asList("java", "python", "javascript", "go");

long result = words.stream()
    .filter(word -> word.length() > 4)
    .map(String::toUpperCase)
    .count();

System.out.println(result);`,
                            options: [
                                "2",
                                "3",
                                "4",
                                "Compilation error"
                            ],
                            correct: 0,
                            explanation: "Only 'python' and 'javascript' have length > 4. The count() returns 2. The map() operation doesn't affect the count."
                        },
                        {
                            title: "Concurrency",
                            description: "What's the potential issue with this code?",
                            code: `public class Counter {
    private int count = 0;
    
    public void increment() {
        count++;  // This operation
    }
    
    public int getCount() {
        return count;
    }
}`,
                            options: [
                                "No issues, code is thread-safe",
                                "Race condition - increment is not atomic",
                                "Memory leak",
                                "Compilation error"
                            ],
                            correct: 1,
                            explanation: "The increment operation (count++) is not atomic. Multiple threads can cause race conditions. Use synchronized or AtomicInteger."
                        }
                    ]
                };
                
                this.init();
            }
            
            async init() {
                this.setupEventListeners();
                await this.loadChallengesFromJSON();
                this.loadChallenge();
                this.updateStats();
            }
            
            async loadChallengesFromJSON() {
                this.showLoading(true);
                
                // Try each configured JSON source
                for (const jsonUrl of this.jsonSources) {
                    try {
                        console.log(`🔄 Trying to load from: ${jsonUrl}`);
                        const response = await this.fetchWithTimeout(jsonUrl, 5000);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            // Validate JSON structure
                            if (this.validateJSONStructure(data)) {
                                this.apiChallenges = data;
                                console.log('✅ Challenges loaded from JSON successfully!');
                                this.showApiStatus('JSON Loaded', 'success');
                                this.showLoading(false);
                                return;
                            } else {
                                console.log('⚠️ Invalid JSON structure, trying next source...');
                            }
                        }
                    } catch (error) {
                        console.log(`⚠️ Failed to load from ${jsonUrl}:`, error.message);
                    }
                }
                
                // If all JSON sources fail, use fallback challenges
                console.log('⚠️ All JSON sources failed, using built-in challenges');
                this.apiChallenges = this.fallbackChallenges;
                this.showApiStatus('Built-in Questions', 'offline');
                this.showLoading(false);
            }
            
            fetchWithTimeout(url, timeout = 5000) {
                return Promise.race([
                    fetch(url),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Timeout')), timeout)
                    )
                ]);
            }
            
            formatAPIData(data) {
                // Format your custom API data structure
                // Expected format: { beginner: [...], intermediate: [...], advanced: [...] }
                return data;
            }
            
            validateJSONStructure(data) {
                // Check if the JSON has the required structure
                if (!data || typeof data !== 'object') return false;
                
                const requiredLevels = ['beginner', 'intermediate', 'advanced'];
                const requiredFields = ['title', 'description', 'code', 'options', 'correct', 'explanation'];
                
                for (const level of requiredLevels) {
                    if (!Array.isArray(data[level])) return false;
                    
                    for (const challenge of data[level]) {
                        // Check if all required fields exist
                        for (const field of requiredFields) {
                            if (!(field in challenge)) return false;
                        }
                        
                        // Validate specific field types
                        if (!Array.isArray(challenge.options) || challenge.options.length < 2) return false;
                        if (typeof challenge.correct !== 'number' || challenge.correct < 0 || challenge.correct >= challenge.options.length) return false;
                    }
                }
                
                return true;
            }
            
            decodeHTML(html) {
                const txt = document.createElement('textarea');
                txt.innerHTML = html;
                return txt.value;
            }
            
            showLoading(show) {
                this.isLoading = show;
                const card = document.getElementById('challengeCard');
                
                if (show) {
                    card.innerHTML = `
                        <div style="text-align: center; padding: 60px;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">⏳</div>
                            <h3>Loading Challenges...</h3>
                            <p style="color: #666; margin-top: 10px;">Fetching questions from API</p>
                        </div>
                    `;
                } else {
                    // Loading complete, will be replaced by challenge content
                }
            }
            
            showApiStatus(status, type) {
                const statusColors = {
                    success: '#4CAF50',
                    demo: '#FF9800', 
                    offline: '#9E9E9E'
                };
                
                const statusIcons = {
                    success: '🌐',
                    demo: '🔄',
                    offline: '📱'
                };
                
                // Add status indicator to header
                const header = document.querySelector('.header');
                const existingStatus = header.querySelector('.api-status');
                if (existingStatus) existingStatus.remove();
                
                const statusDiv = document.createElement('div');
                statusDiv.className = 'api-status';
                statusDiv.style.cssText = `
                    position: absolute;
                    top: 20px;
                    right: 20px;
                    background: ${statusColors[type]};
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                `;
                statusDiv.innerHTML = `${statusIcons[type]} ${status}`;
                header.style.position = 'relative';
                header.appendChild(statusDiv);
                
                this.showLoading(false);
            }
            
            setupEventListeners() {
                // Difficulty selector
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentLevel = e.target.dataset.level;
                        this.currentChallengeIndex = 0;
                        this.selectedAnswer = null;
                        this.hasSubmittedAnswer = false;
                        this.resetLevelStats();
                        this.loadChallenge();
                    });
                });
            }
            
            loadChallenge() {
                // Use API challenges if available, otherwise fallback
                const challenges = this.apiChallenges[this.currentLevel] || this.fallbackChallenges[this.currentLevel];
                const challenge = challenges[this.currentChallengeIndex];
                
                if (!challenge) {
                    this.showCompletion();
                    return;
                }
                
                const card = document.getElementById('challengeCard');
                card.innerHTML = `
                    <div class="challenge-title">${challenge.title}</div>
                    <div class="challenge-description">${challenge.description}</div>
                    <div class="code-example">${challenge.code}</div>
                    <div class="answer-section">
                        <div class="answer-options">
                            ${challenge.options.map((option, index) => `
                                <div class="answer-btn" data-index="${index}">
                                    <strong>${String.fromCharCode(65 + index)}:</strong> ${option}
                                </div>
                            `).join('')}
                        </div>
                        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <button class="submit-btn" disabled>Submit Answer</button>
                        </div>
                        <div class="feedback" id="feedback"></div>
                    </div>
                `;
                
                this.setupAnswerListeners();
                this.updateProgress();
                this.updateNavigationButtons();
            }
            
            setupAnswerListeners() {
                const answerBtns = document.querySelectorAll('.answer-btn');
                const submitBtn = document.querySelector('.submit-btn');
                
                answerBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        answerBtns.forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedAnswer = parseInt(btn.dataset.index);
                        submitBtn.disabled = false;
                    });
                });
                
                submitBtn.addEventListener('click', () => this.submitAnswer());
            }
            
            submitAnswer() {
                const challenges = this.apiChallenges[this.currentLevel] || this.fallbackChallenges[this.currentLevel];
                const challenge = challenges[this.currentChallengeIndex];
                const feedback = document.getElementById('feedback');
                const answerBtns = document.querySelectorAll('.answer-btn');
                const submitBtn = document.querySelector('.submit-btn');
                
                // Show correct/incorrect answers
                answerBtns.forEach((btn, index) => {
                    if (index === challenge.correct) {
                        btn.classList.add('correct');
                    } else if (index === this.selectedAnswer && index !== challenge.correct) {
                        btn.classList.add('incorrect');
                    }
                    btn.style.pointerEvents = 'none';
                });
                
                // Show feedback
                const isCorrect = this.selectedAnswer === challenge.correct;
                feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedback.style.display = 'block';
                const isLastChallenge = this.currentChallengeIndex >= challenges.length - 1;
                feedback.innerHTML = `
                    <strong>${isCorrect ? '🎉 Correct!' : '❌ Incorrect'}</strong><br>
                    ${challenge.explanation}
                    <button class="next-btn" onclick="${isLastChallenge ? 'game.showResultsModal()' : 'game.nextChallenge()'}">
                        ${isLastChallenge ? 'Complete Level' : 'Next Question'} →
                    </button>
                `;
                
                // Update stats
                const levelPoints = this.currentLevel === 'beginner' ? 10 : this.currentLevel === 'intermediate' ? 20 : 30;
                
                if (isCorrect) {
                    this.score += levelPoints;
                    this.streak++;
                    this.levelStats.correctAnswers++;
                    this.levelStats.levelScore += levelPoints;
                    
                    // 🎉 CELEBRATION TIME! 🎉
                    this.triggerCelebration(levelPoints);
                } else {
                    this.streak = 0;
                }
                
                // Track max streak for this level
                this.levelStats.maxStreak = Math.max(this.levelStats.maxStreak, this.streak);
                this.levelStats.totalQuestions++;
                
                this.completed++;
                this.hasSubmittedAnswer = true;
                this.updateStats();
                submitBtn.disabled = true;
            }
            
            triggerCelebration(points) {
                // 1. Confetti explosion
                this.createConfetti();
                
                // 2. Score popup animation
                this.showScorePopup(points);
                
                // 3. Streak indicator (if streak > 1)
                if (this.streak > 1) {
                    this.showStreakIndicator();
                }
                
                // 4. Success sound effect (visual representation)
                this.flashSuccessColors();
            }
            
            createConfetti() {
                const overlay = document.createElement('div');
                overlay.className = 'celebration-overlay';
                document.body.appendChild(overlay);
                
                // Create 50 confetti pieces
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    overlay.appendChild(confetti);
                }
                
                // Remove confetti after animation
                setTimeout(() => {
                    document.body.removeChild(overlay);
                }, 4000);
            }
            
            showScorePopup(points) {
                const popup = document.createElement('div');
                popup.className = 'score-popup';
                popup.innerHTML = `🎯 +${points} Points!`;
                document.body.appendChild(popup);
                
                // Remove popup after animation
                setTimeout(() => {
                    document.body.removeChild(popup);
                }, 2000);
            }
            
            showStreakIndicator() {
                // Remove existing streak indicator if any
                const existing = document.querySelector('.streak-indicator');
                if (existing) existing.remove();
                
                const indicator = document.createElement('div');
                indicator.className = 'streak-indicator';
                indicator.innerHTML = `🔥 ${this.streak} Streak!`;
                document.body.appendChild(indicator);
                
                // Show with animation
                setTimeout(() => indicator.classList.add('show'), 100);
                
                // Hide after 3 seconds
                setTimeout(() => {
                    indicator.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(indicator)) {
                            document.body.removeChild(indicator);
                        }
                    }, 500);
                }, 3000);
            }
            
            flashSuccessColors() {
                const header = document.querySelector('.header');
                const originalBackground = header.style.background;
                
                // Flash green
                header.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                header.style.transition = 'background 0.3s ease';
                
                // Return to original after 600ms
                setTimeout(() => {
                    header.style.background = originalBackground || 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                }, 600);
            }
            
            nextChallenge() {
                const challenges = this.apiChallenges[this.currentLevel] || this.fallbackChallenges[this.currentLevel];
                
                if (this.currentChallengeIndex < challenges.length - 1) {
                    this.currentChallengeIndex++;
                    this.selectedAnswer = null;
                    this.hasSubmittedAnswer = false;
                    this.loadChallenge();
                }
            }
            
            updateStats() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('streak').textContent = this.streak;
                document.getElementById('completed').textContent = this.completed;
                document.getElementById('currentScore').textContent = this.score;
            }
            
            updateProgress() {
                const challenges = this.apiChallenges[this.currentLevel] || this.fallbackChallenges[this.currentLevel];
                const totalChallenges = challenges.length;
                const progress = (this.currentChallengeIndex / totalChallenges) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }
            
            updateNavigationButtons() {
                // Show challenge counter in the header or progress area
                const challenges = this.apiChallenges[this.currentLevel] || this.fallbackChallenges[this.currentLevel];
                const currentPos = this.currentChallengeIndex + 1;
                const totalChallenges = challenges.length;
                
                // Add challenge counter to the challenge card
                let counterDiv = document.querySelector('.challenge-counter');
                if (!counterDiv) {
                    counterDiv = document.createElement('div');
                    counterDiv.className = 'challenge-counter';
                    counterDiv.style.cssText = `
                        font-size: 0.9rem;
                        color: #666;
                        text-align: center;
                        padding: 8px 15px;
                        background: #f0f0f0;
                        border-radius: 15px;
                        margin-bottom: 20px;
                    `;
                    const challengeCard = document.querySelector('.challenge-card');
                    challengeCard.insertBefore(counterDiv, challengeCard.firstChild);
                }
                counterDiv.textContent = `Question ${currentPos} of ${totalChallenges}`;
            }
            
            // Method to refresh challenges from JSON
            async refreshChallenges() {
                this.currentChallengeIndex = 0;
                await this.loadChallengesFromJSON();
                this.loadChallenge();
            }
            
            showCompletion() {
                this.showResultsModal();
            }
            
            resetLevel() {
                this.currentChallengeIndex = 0;
                this.loadChallenge();
            }
            
            resetLevelStats() {
                this.levelStats = {
                    correctAnswers: 0,
                    totalQuestions: 0,
                    maxStreak: 0,
                    levelScore: 0
                };
            }
            
            showResultsModal() {
                const modal = document.getElementById('resultsModal');
                const accuracy = this.levelStats.totalQuestions > 0 ? 
                    Math.round((this.levelStats.correctAnswers / this.levelStats.totalQuestions) * 100) : 0;
                
                // Update modal content
                document.getElementById('finalScore').textContent = this.levelStats.levelScore;
                document.getElementById('correctAnswers').textContent = 
                    `${this.levelStats.correctAnswers}/${this.levelStats.totalQuestions}`;
                document.getElementById('accuracy').textContent = `${accuracy}%`;
                document.getElementById('maxStreak').textContent = this.levelStats.maxStreak;
                
                // Determine performance level and styling
                let emoji, title, badgeText, badgeClass;
                
                if (accuracy >= 80) {
                    emoji = '🎉';
                    title = 'Outstanding Performance!';
                    badgeText = 'Excellent Work!';
                    badgeClass = 'performance-excellent';
                } else if (accuracy >= 60) {
                    emoji = '👍';
                    title = 'Good Job!';
                    badgeText = 'Well Done!';
                    badgeClass = 'performance-good';
                } else {
                    emoji = '💪';
                    title = 'Keep Practicing!';
                    badgeText = 'Room for Improvement';
                    badgeClass = 'performance-needs-improvement';
                }
                
                document.getElementById('resultsEmoji').textContent = emoji;
                document.getElementById('resultsTitle').textContent = title;
                document.getElementById('performanceBadge').textContent = badgeText;
                document.getElementById('performanceBadge').className = `performance-badge ${badgeClass}`;
                
                // Show modal with animation
                modal.classList.add('show');
            }
            
            closeModal() {
                const modal = document.getElementById('resultsModal');
                modal.classList.remove('show');
            }
            
            tryNextLevel() {
                const levels = ['beginner', 'intermediate', 'advanced'];
                const currentIndex = levels.indexOf(this.currentLevel);
                
                if (currentIndex < levels.length - 1) {
                    // Move to next level
                    const nextLevel = levels[currentIndex + 1];
                    this.currentLevel = nextLevel;
                    
                    // Update difficulty buttons
                    document.querySelectorAll('.difficulty-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.level === nextLevel) {
                            btn.classList.add('active');
                        }
                    });
                    
                    this.currentChallengeIndex = 0;
                    this.resetLevelStats();
                    this.closeModal();
                    this.loadChallenge();
                } else {
                    // Already at highest level
                    alert('🎉 Congratulations! You\'ve completed all levels!');
                    this.closeModal();
                }
            }
            
            retryLevel() {
                this.currentChallengeIndex = 0;
                
                // Reset all game stats
                this.score = 0;
                this.streak = 0;
                this.completed = 0;
                
                this.resetLevelStats();
                this.updateStats();
                this.closeModal();
                this.loadChallenge();
            }
        }
        
        // Initialize the game
        const game = new JavaChallengeGame();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976e43d8e02bc1a6',t:'MTc1NjQ5Mzc1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
